<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Emotion Analysis Tool</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
        }
        h1, h2 {
            color: #333;
        }
        select, button {
            padding: 10px;
            margin: 10px 0;
            width: 100%;
            max-width: 400px;
        }
        .output-container {
            margin-top: 20px;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 8px;
            background-color: #f9f9f9;
        }
        .output-section {
            margin-bottom: 20px;
        }
        .output-section h3 {
            margin-bottom: 10px;
            color: #555;
        }
        .output-section p, .output-section ul {
            white-space: pre-wrap;
            line-height: 1.6;
            color: #333;
        }
        ul {
            padding-left: 20px;
        }
    </style>
</head>
<body>
    <h1>Emotion Analysis Tool</h1>
    <label for="primary-emotion">Primary Emotion:</label>
    <select id="primary-emotion"></select>

    <label for="secondary-emotion">Secondary Emotion:</label>
    <select id="secondary-emotion"></select>

    <label for="tertiary-emotion">Tertiary Emotion:</label>
    <select id="tertiary-emotion"></select>

    <label for="influence">Influence:</label>
    <select id="influence"></select>

    <button onclick="retrieveAnalysis()">Check</button>

    <div id="output" class="output-container" style="display:none;">
        <div class="output-section">
            <h3>Clarify the Emotion</h3>
            <p id="clarify-emotion"></p>
        </div>
        <div class="output-section">
            <h3>Explore the Influence</h3>
            <p id="explore-influence"></p>
        </div>
        <div class="output-section">
            <h3>Insights and Guidance</h3>
            <ul id="insights-guidance"></ul>
        </div>
    </div>

    <script>
        let data = [];

        // Fetch the JSON data and populate dropdowns
        fetch('full_list_new_new.json')
            .then(response => response.json())
            .then(json => {
                data = json;
                populateDropdowns();
                console.log('Data loaded successfully:', data);
            })
            .catch(error => {
                console.error('Error loading data:', error);
                alert('Error loading data. Please try again.');
            });

        // Populate dropdowns with unique values
        function populateDropdowns() {
            const primarySet = new Set();
            const secondarySet = new Set();
            const tertiarySet = new Set();
            const influenceSet = new Set();

            data.forEach(item => {
                primarySet.add(item.primary_emotion.trim());
                secondarySet.add(item.secondary_emotion.trim());
                tertiarySet.add(item.tertiary_emotion.trim());
                influenceSet.add(item.influence.trim());
            });

            populateSelect('primary-emotion', primarySet);
            populateSelect('secondary-emotion', secondarySet);
            populateSelect('tertiary-emotion', tertiarySet);
            populateSelect('influence', influenceSet);
        }

        // Helper function to populate a select element
        function populateSelect(selectId, optionsSet) {
            const selectElement = document.getElementById(selectId);
            selectElement.innerHTML = '<option value="">Select</option>';
            optionsSet.forEach(option => {
                const opt = document.createElement('option');
                opt.value = option;
                opt.textContent = option;
                selectElement.appendChild(opt);
            });
        }

        // Retrieve and display the analysis
        function retrieveAnalysis() {
            const primary = document.getElementById('primary-emotion').value.trim().toLowerCase();
            const secondary = document.getElementById('secondary-emotion').value.trim().toLowerCase();
            const tertiary = document.getElementById('tertiary-emotion').value.trim().toLowerCase();
            const influence = document.getElementById('influence').value.trim().toLowerCase();

            if (!primary || !secondary || !tertiary || !influence) {
                alert('Please select all fields.');
                return;
            }

            console.log('Selected values:', { primary, secondary, tertiary, influence });

            const result = data.find(item =>
                item.primary_emotion.trim().toLowerCase() === primary &&
                item.secondary_emotion.trim().toLowerCase() === secondary &&
                item.tertiary_emotion.trim().toLowerCase() === tertiary &&
                item.influence.trim().toLowerCase() === influence
            );

            if (result) {
                document.getElementById('clarify-emotion').innerHTML = formatText(result.analysis.clarify_emotion || 'No data provided.');
                document.getElementById('explore-influence').innerHTML = formatText(result.analysis.explore_influence || 'No data provided.');

                const insightsList = document.getElementById('insights-guidance');
                insightsList.innerHTML = '';
                (result.analysis.insights_guidance || []).forEach(insight => {
                    const li = document.createElement('li');
                    li.textContent = insight;
                    insightsList.appendChild(li);
                });

                document.getElementById('output').style.display = 'block';
            } else {
                console.warn('No matching analysis found for:', { primary, secondary, tertiary, influence });
                alert('No matching analysis found.');
                document.getElementById('output').style.display = 'none';
            }
        }

        // Format the text for better readability
        function formatText(text) {
            if (!text) return 'No data provided.';
            return text
                .replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>')  // Bold for **text**
                .replace(/\n/g, '<br>')                             // Line breaks
                .replace(/- (.*?)(\n|$)/g, '<li>$1</li>');          // Convert - to list items
        }
    </script>
</body>
</html>