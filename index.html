<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Emotion Analysis Tool</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
        }
        h1, h3 {
            text-align: center;
        }
        label {
            font-weight: bold;
        }
        select, button {
            display: block;
            margin: 10px 0;
            padding: 5px;
            width: 100%;
        }
        #output {
            border: 1px solid #ccc;
            padding: 20px;
            margin-top: 20px;
        }
    </style>
</head>
<body>
    <h1>Emotion Analysis Tool</h1>
    
    <label for="primary">Primary Emotion:</label>
    <select id="primary" onchange="populateSecondaryDropdown()">
        <option value="">Select Primary Emotion</option>
    </select>
    
    <label for="secondary">Secondary Emotion:</label>
    <select id="secondary" onchange="populateTertiaryDropdown()">
        <option value="">Select Secondary Emotion</option>
    </select>
    
    <label for="tertiary">Tertiary Emotion:</label>
    <select id="tertiary">
        <option value="">Select Tertiary Emotion</option>
    </select>
    
    <label for="influence">Influence:</label>
    <select id="influence">
        <option value="">Select Influence</option>
    </select>
    
    <button onclick="checkAnalysis()">Check</button>
    
    <div id="output"></div>

    <script>
        let data = [];
        
        // Fetch the JSON file and load data
        fetch('new.json')
            .then(response => response.json())
            .then(json => {
                data = json;
                populatePrimaryDropdown();
            })
            .catch(error => {
                console.error('Error loading data:', error);
                alert('Error loading data. Please try again.');
            });

        function populatePrimaryDropdown() {
            const primaryDropdown = document.getElementById('primary');
            const uniquePrimary = [...new Set(data.map(item => item.primary_emotion))];
            uniquePrimary.forEach(emotion => {
                const option = document.createElement('option');
                option.value = emotion;
                option.textContent = emotion;
                primaryDropdown.appendChild(option);
            });
        }

        function populateSecondaryDropdown() {
            const secondaryDropdown = document.getElementById('secondary');
            secondaryDropdown.innerHTML = '<option value="">Select Secondary Emotion</option>';
            const selectedPrimary = document.getElementById('primary').value;
            const filteredData = data.filter(item => item.primary_emotion === selectedPrimary);
            const uniqueSecondary = [...new Set(filteredData.map(item => item.secondary_emotion))];
            uniqueSecondary.forEach(emotion => {
                const option = document.createElement('option');
                option.value = emotion;
                option.textContent = emotion;
                secondaryDropdown.appendChild(option);
            });
        }

        function populateTertiaryDropdown() {
            const tertiaryDropdown = document.getElementById('tertiary');
            tertiaryDropdown.innerHTML = '<option value="">Select Tertiary Emotion</option>';
            const selectedPrimary = document.getElementById('primary').value;
            const selectedSecondary = document.getElementById('secondary').value;
            const filteredData = data.filter(item => item.primary_emotion === selectedPrimary && item.secondary_emotion === selectedSecondary);
            const uniqueTertiary = [...new Set(filteredData.map(item => item.tertiary_emotion))];
            uniqueTertiary.forEach(emotion => {
                const option = document.createElement('option');
                option.value = emotion;
                option.textContent = emotion;
                tertiaryDropdown.appendChild(option);
            });
        }

        function checkAnalysis() {
            const selectedPrimary = document.getElementById('primary').value;
            const selectedSecondary = document.getElementById('secondary').value;
            const selectedTertiary = document.getElementById('tertiary').value;
            const selectedInfluence = document.getElementById('influence').value;

            const result = data.find(item =>
                item.primary_emotion === selectedPrimary &&
                item.secondary_emotion === selectedSecondary &&
                item.tertiary_emotion === selectedTertiary &&
                item.influence === selectedInfluence
            );

            displayAnalysis(result ? result.analysis : null);
        }

        function displayAnalysis(analysis) {
            const outputDiv = document.getElementById('output');
            
            if (!analysis) {
                outputDiv.innerHTML = '<p>No matching analysis found.</p>';
                return;
            }

            outputDiv.innerHTML = `
                <h3>Analysis:</h3>
                <div>
                    <h4>Clarify the Emotion:</h4>
                    <p>${extractSection(analysis, '**Clarify the Emotion:**', '**Explore the Influence:**')}</p>

                    <h4>Explore the Influence:</h4>
                    <p>${extractSection(analysis, '**Explore the Influence:**', '**Insights and Guidance:**')}</p>

                    <h4>Insights and Guidance:</h4>
                    <p>${extractSection(analysis, '**Insights and Guidance:**')}</p>
                </div>
            `;
        }

        function extractSection(text, startMarker, endMarker = null) {
            const startIndex = text.indexOf(startMarker) + startMarker.length;
            const endIndex = endMarker ? text.indexOf(endMarker) : text.length;
            return text.substring(startIndex, endIndex).trim();
        }
    </script>
</body>
</html>
